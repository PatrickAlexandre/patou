<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Super Calculateur et Assistant Domotique AI</title>
  
  <!-- Bootstrap CSS -->
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- Tailwind CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.1.2/dist/tailwind.min.css" rel="stylesheet">
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>
<body class="bg-gray-100">
  <div class="container my-5">
    <h1 class="text-center text-4xl font-bold mb-4">Super Calculateur et Assistant Domotique AI</h1>
    
    <!-- Formulaire de saisie des données -->
    <form id="userForm" class="bg-white p-5 rounded shadow-lg mb-5">
      <h2 class="text-2xl font-semibold mb-4"><i class="fas fa-user"></i> Informations personnelles</h2>
      
      <div class="form-row">
        <div class="form-group col-md-6">
          <label for="birthdate">Date de naissance</label>
          <input type="date" class="form-control" id="birthdate" required>
        </div>
        <div class="form-group col-md-6">
          <label for="weight">Poids (kg)</label>
          <input type="number" class="form-control" id="weight" placeholder="Entrez votre poids" min="20" max="300" required>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group col-md-6">
          <label for="height">Taille (cm)</label>
          <input type="number" class="form-control" id="height" placeholder="Entrez votre taille" min="100" max="250" required>
        </div>
        <div class="form-group col-md-6">
          <label for="gender">Genre</label>
          <select class="form-control" id="gender" required>
            <option value="male">Homme</option>
            <option value="female">Femme</option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label for="activityLevel">Niveau d'Activité Physique</label>
        <select class="form-control" id="activityLevel" required>
          <option value="1.2">Sédentaire (peu ou pas d'exercice)</option>
          <option value="1.375">Légèrement actif (exercice léger, 1 à 3 jours par semaine)</option>
          <option value="1.55">Modérément actif (exercice modéré, 3 à 5 jours par semaine)</option>
          <option value="1.725">Très actif (exercice intense, 6 à 7 jours par semaine)</option>
          <option value="1.9">Extrêmement actif (activité physique très intense ou travail physique intense)</option>
        </select>
      </div>

      <button type="button" class="btn btn-primary mt-3" onclick="calculateMetrics()">Calculer</button>
    </form>

    <!-- Section des résultats -->
    <div id="results" class="bg-white p-5 rounded shadow-lg hidden">
      <h2 class="text-2xl font-semibold mb-4"><i class="fas fa-chart-line"></i> Résultats de santé</h2>

      <p><i class="fas fa-birthday-cake"></i> Âge : <strong id="age" class="font-weight-bold"></strong></p>
      <p><i class="fas fa-life-ring"></i> Espérance de vie : <strong id="lifeExpectancy" class="font-weight-bold"></strong> ans</p>
      <p><i class="fas fa-burn"></i> TDEE : <strong id="tdee" class="font-weight-bold"></strong> kcal</p>
      <p><i class="fas fa-heart"></i> BMR : <strong id="bmr" class="font-weight-bold"></strong> kcal</p>
      <p><i class="fas fa-weight"></i> Poids idéal : <strong id="idealWeight" class="font-weight-bold"></strong> kg</p>
      <p><i class="fas fa-bullseye"></i> Objectifs de poids : <strong id="weightGoal" class="font-weight-bold"></strong></p>
      <p><i class="fas fa-ruler-vertical"></i> IMC : <strong id="bmi" class="font-weight-bold"></strong></p>

      <div class="progress mb-3">
        <div id="lifeProgress" class="progress-bar" role="progressbar"></div>
      </div>
    </div>
  </div>

<script>
  // Charger les données du localStorage si elles existent
  function loadFormData() {
    $('#birthdate').val(localStorage.getItem('birthdate') || '');
    $('#weight').val(localStorage.getItem('weight') || '');
    $('#height').val(localStorage.getItem('height') || '');
    $('#gender').val(localStorage.getItem('gender') || '');
    $('#activityLevel').val(localStorage.getItem('activityLevel') || '1.2');
  }

  // Fonction principale de calcul
  function calculateMetrics() {
    // Validation et récupération des valeurs
    const birthdate = new Date($('#birthdate').val());
    const weight = parseFloat($('#weight').val());
    const height = parseFloat($('#height').val());
    const gender = $('#gender').val();
    const activityLevel = parseFloat($('#activityLevel').val());
    const today = new Date();
    let ageYears = today.getFullYear() - birthdate.getFullYear();

    // Validation de l'âge
    if (today < new Date(today.getFullYear(), birthdate.getMonth(), birthdate.getDate())) {
      ageYears--;
    }
    if (ageYears <= 0 || ageYears > 120 || isNaN(weight) || isNaN(height)) {
      alert('Veuillez entrer des valeurs réalistes.');
      return;
    }

    // Calcul du BMR (Basal Metabolic Rate) en fonction du genre
    const bmr = gender === 'male' 
      ? 88.362 + (13.397 * weight) + (4.799 * height) - (5.677 * ageYears)
      : 447.593 + (9.247 * weight) + (3.098 * height) - (4.330 * ageYears);

    // Calcul du TDEE (Total Daily Energy Expenditure)
    const tdee = bmr * activityLevel;

    // Poids idéal (formule simplifiée)
    const idealWeight = gender === 'male'
      ? height - 100 - ((height - 150) / 4)
      : height - 100 - ((height - 150) / 2.5);

    // Calcul de l'IMC (Body Mass Index)
    const bmi = (weight / ((height / 100) ** 2)).toFixed(2);

    // Objectif de poids
    let weightGoal;
    const weightDifference = weight - idealWeight;
    weightGoal = weightDifference > 0 
      ? `- ${Math.abs(weightDifference).toFixed(2)} kg`
      : weightDifference < 0 
      ? `+ ${Math.abs(weightDifference).toFixed(2)} kg`
      : 'Votre poids est idéal !';

        // Portion de vie restante
        const lifeExpectancy = gender === 'male' ? 75 : 80;
        const lifeRemainingYears = lifeExpectancy - ageYears;
        const lifeRemainingPercent = ((lifeRemainingYears / lifeExpectancy) * 100).toFixed(2);

        // Affichage des résultats
        $('#age').text(`${ageYears} ans`);
        $('#lifeExpectancy').text(lifeExpectancy);
        $('#tdee').text(tdee.toFixed(2));
        $('#bmr').text(bmr.toFixed(2));
        $('#idealWeight').text(idealWeight.toFixed(2));
        $('#weightGoal').text(weightGoal);
        $('#bmi').text(bmi);
        $('#lifeProgress')
            .css('width', lifeRemainingPercent + '%')
            .attr('aria-valuenow', lifeRemainingPercent)
            .text(`${lifeRemainingPercent}% ${lifeRemainingYears}`);

            
    // Sauvegarder les données
    localStorage.setItem('birthdate', $('#birthdate').val());
    localStorage.setItem('weight', weight);
    localStorage.setItem('height', height);
    localStorage.setItem('gender', gender);
    localStorage.setItem('activityLevel', activityLevel);

    $('#results').removeClass('hidden').hide().fadeIn();
    $('#userForm').hide();
  }

  $(document).ready(() => loadFormData());
</script>

  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
